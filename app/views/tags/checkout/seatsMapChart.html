%{def seatsMapArray = seatsMap.getAsJsonArray();}%
#{list seatsMapArray, as: 'seatsMap' }
<div class="container" id="seatsmapBlock_${seatsMap_index}" style="display: none;">
<div class="from-to-block txt-from-to-block">${seatsMap.type.getAsString()}</div>
<div class="from-to-block info-from-to">${seatsMap.origin.getAsString()} => ${seatsMap.destination.getAsString()}</div>

<div id="seat-map" class="seatCharts-container airplane-drawing">
<div class="front-indicator">Frente</div>

	<div class="position-relative-seat">
		<div class="position-absolute-seat">
		#{list seatsMap.cabins, as: 'cabin' }
		%{def columnsDataArray = cabin.getAsJsonObject().get("columns").getAsJsonArray(); }%
			<div class="">
				<div class="">
				#{list columnsDataArray, as: 'column' }
					<div class="" style="display:inline-flex;font-size:8px">
						${column.get("type").getAsString()}
					</div>
				#{/list}
				</div>
			</div>
			#{list cabin.rows, as: 'row' }

					<div class="seatCharts-row">
					<div class="seatCharts-cell seatCharts-space">${row.rowNumber}</div>
						#{list row.seats, as: 'seat' }

							#{if seat_index > 2 && columnsDataArray.get(seat_index-1).getAsJsonObject().get("type").getAsString().equals("Aisle") }
								#{if columnsDataArray.get(seat_index-2).getAsJsonObject().get("type").getAsString().equals("Aisle") }
									<div class="seatCharts-cell seatCharts-space"></div>
								#{/if}
							#{/if}
							#{if !columnsDataArray.get(seat_index-1).getAsJsonObject().get("type").getAsString().equals("Empty")}
							<div id="${row.rowNumber}${seat.number.getAsString()}" role="checkbox"  class="seatCharts-seat seatCharts-cell economy-class chargeable">${seat.number.getAsString()}</div>
							#{/if}
							#{elseif}
							<div class="seatCharts-cell seatCharts-space"></div>
							#{/elseif}



							*{#{if columnsDataArray.get(seat_index-1).getAsJsonObject().get("type").getAsString().equals("Aisle") }
								<div class="seatCharts-cell seatCharts-space"></div>
							#{/if}
							#{elseif seat.getAsJsonObject().get("chargeableInd").getAsBoolean()}
								<div id="${row.rowNumber}${seat.number.getAsString()}" role="checkbox"  class="seatCharts-seat seatCharts-cell economy-class chargeable">${seat.number.getAsString()}</div>
							#{/elseif}
							#{elseif seat.getAsJsonObject().get("occupiedInd").getAsBoolean() || seat.getAsJsonObject().get("inoperativeInd").getAsBoolean() }
								<div id="${row.rowNumber}${seat.number.getAsString()}" role="checkbox"  class="seatCharts-seat seatCharts-cell economy-class unavailable">${seat.number.getAsString()}</div>
							#{/elseif}
							#{else}
								<div id="${row.rowNumber}${seat.number.getAsString()}" role="checkbox"  class="seatCharts-seat seatCharts-cell economy-class available">${seat.number.getAsString()}</div>
							#{/else}}*
						#{/list}
					</div>
				
			#{/list}
		#{/list}
		</div>
	</div>
	
</div>
</div>



#{/list}

<div class="container" id="selectedSeatsBlock" style="display: none;">

</div>

<div class="text-right">
	<a class="btn btn-search" id="btnContinue">Continuar</a>
	<a class="btn btn-search" id="btnConfirm" style="display: none;">Confirmar Asientos</a>
</div>	

	<script>
	var seatsSelected = 0;
	var indexSeatMap = 1;
	var selectionArr = new Array();
	var finalSelectionArr = new Array();
	var numberOfMaps = ${seatsMapArray.size()};	
	
	$(function () {
		
		$("#seatsmapBlock_1").show();
		$("#btnConfirm").click(function() {
			$('#modalSeatsMap').modal('toggle');
		});
		
		
		$("#btnContinue").click(function() {
			
			if (indexSeatMap <= numberOfMaps) {
				$("#seatsmapBlock_"+indexSeatMap).hide();
				indexSeatMap++;
				seatsSelected = 0;
				finalSelectionArr.push(selectionArr);
				selectionArr = new Array();
				$("#seatsmapBlock_"+indexSeatMap).show();
				if (indexSeatMap>numberOfMaps){
					indexSeatMap--;
					$("#seatsmapBlock_"+indexSeatMap).hide();
					$("#btnContinue").hide();
					$("#btnConfirm").show();
					$("#selectedSeatsBlock").show();
					for (var i=0;i<finalSelectionArr.length;i++){
						$("#selectedSeatsBlock").html($("#selectedSeatsBlock").html() + finalSelectionArr[i] +"<br>");
					}
				}

			}
		});
		
		$(".seatCharts-seat").mouseenter(function() {
			if ($(this).hasClass("available")) {
				$(this).addClass("focused");
			}
		});
		$(".seatCharts-seat").mouseout(function() {
			
			if ($(this).hasClass("focused")) {
				$(this).removeClass("focused");
			}
		});
		$(".seatCharts-seat").click(function() {
			if (!$(this).hasClass("unavailable") && !$(this).hasClass("selected") && seatsSelected < ${numberOfSeats}) {
				$(this).addClass("selected");
				seatsSelected++;
				selectionArr.push(this.id);
				return;
			}
			if ($(this).hasClass("selected")  ) {
				$(this).removeClass("selected");
				selectionArr.splice(selectionArr.indexOf(this.id),1);
				seatsSelected--;
			}
		});
	});
	</script>
