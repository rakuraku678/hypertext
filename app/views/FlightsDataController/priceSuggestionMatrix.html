%{
firstDepartureDate = alternateDatesDto.departuredate.minusDays(3);
firstReturnDate = alternateDatesDto.returndate.minusDays(3);
fmt = org.joda.time.format.DateTimeFormat.forPattern("yyyy-MM-dd");
lineReturnDate = null;
rowDepartureDate = null;
lastRowDate = firstDepartureDate.minusDays(1);

}%
<div class="table-responsive table-arrive">
    <table border="1">
        <thead>
        <tr>
            <th colspan="4"></th>
            <!--<th><a href="#">Tendencia de tarifas</a></th>-->

            <th colspan="2" class="select-th"><a href="#">Precios +/- 5 días</a></th>
            <th colspan="2"><a href="#">Precios por aerolíneas</a></th>
        </tr>
        </thead>
        <tbody>
        <tr class="bg-returning">
            <td class="leaving-returning">
                <span>ida</span>
                <span>vuelta</span>
            </td>
            #{list items:0..6, as:'i'}
                <td>${fmt.print(firstDepartureDate.plusDays(i))}</td>
            #{/list}
        </tr>
        #{list items:alternateDatesDto.detailAlternateDatesDtoList, as:'details'}
            #{if lineReturnDate != details.returnDate }
                %{
                    lineReturnDate = details.returnDate;
                    lastRowDate = firstDepartureDate.minusDays(1);;
                    rowDepartureDate = null;
                }%
                <tr>
                    <td class="bg-leaving">${fmt.print(details.returnDate)}</td>
            #{/if}

            %{
            int days = org.joda.time.Days.daysBetween(lastRowDate, details.departureDate).getDays();
            }%
            #{if days > 1 }
                #{list items:1..days-1, as:'i'}
                <td></td>
                #{/list}
            #{/if}

            #{if rowDepartureDate != details.departureDate }
            %{ rowDepartureDate = details.departureDate;}%
            %{ lastRowDate = details.departureDate;}%
                <td>$${details.passengerFare}
                *{${details.sequenceNumber}<br>}*
                *{${details.passengerFare}<br>}*
                *{${fmt.print(details.departureDate)}<br>}*
                *{${fmt.print(details.returnDate)}<br>}*
                *{${details.flightsCount}<br>}*
                </td>
            #{/if}
            #{if lineReturnDate != details.returnDate }
                </tr>
            #{/if}
        #{/list}
        <tr class="bg-returning"><td colspan="8">Precio del pasaje ida y vuelta por persona. Los precios visualizados son los mejores encontrados por los usuarios en los últimos días y podrían no estar actualizados.</td></tr>
        </tbody>
    </table>
</div>