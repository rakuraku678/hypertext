#{extends 'main.html' /}
#{set title:'PaymentFlow' /}

#{set isAgencyHeader: true /}

<section class="bg-path">
    <article class="container-fluid">
        <div class="row">
            <ul class="general-path">
                <li>
                    <span class="circle-path icon-checked-path"></span>
                    <span class="name-path">búsqueda</span>
                </li>
                <li class="line-path">
                    <span class="circle-path bg-circle-path">2</span>
                    <span class="name-path">pasajeros</span>
                </li>
                <li>
                    <span class="circle-path">3</span>
                    <span class="name-path">pago</span>
                </li>
            </ul>
        </div>
    </article>
</section>

<section class="search-arrive payment-path">
    <form id="checkoutForm" action="javascript:void(0);" method="post">
        <article class="container-fluid">
            <div class="row">
                <h2>¿Quién Viaja?</h2>
                <p class="info-help">En caso de necesitar ayuda comunicarse al correo <strong>ventaonline@travelclub.cl</strong></p>
                <div class="col-md-8">
                    #{checkout.contactBox/}
                    %{ int passengersCount = 0; }%
                    %{ int passengersNumber = 1; }%
                    #{list bfmResultItem.pricing.detail, as:'pricingDetails'}
                        #{list items:1..pricingDetails.quantity.getAsInt(), as:'i'}
                            #{checkout.passengerBox key: passengersCount, passengerNumber: passengersNumber+".1",
                    passengerType: pricingDetails.code.getAsString(), countriesList:countriesList,
                    onlyPassport:onlyPassport, whiteListAirlines:whiteListAirlines,
                    validatingCarrier:validatingCarrier, AllianceMessage:AllianceMessage /}
                            %{ passengersCount++; }%
                            %{ passengersNumber++; }%
                        #{/list}
                    #{/list}
                    *{#{checkout.paymentBox/}}*
                    #{checkout.termsConditionBox/}
                    #{checkout.hiddenInputBox bfmResultItem: bfmResultItem, promotion: promotionDto/}
                </div>
                <div class="col-md-4">
                    #{checkout.flightBox bfmResultItem:bfmResultItem/}
                    #{checkout.summaryBox pricing:bfmResultItem.pricing, pricingCLP:bfmResultItem.pricingCLP, selectedCurrency:selectedCurrency/}

                    #{list items:bfmResultItem.refoundRuleTexts, as:'refoundRuleText'}
                    <li class="title-payment" style="list-style: none;">
                        * ${refoundRuleText.getAsString()}
                    </li>
                    #{/list}

                    #{checkout.airRules airRulesResultList:airRulesResultList/}
                </div>
                #{if params.promotion == "traveldelta"}
                <div class="col-md-4" id="banner_checkout_delta" >
                    <img src="http://res.cloudinary.com/hyvrprjak/image/upload/v1507124198/BancoChile-MiniSites/banner_checkout_500x500.png"/>
                </div>
                #{/if}
            </div>
            <div class="row">
                <div class="col-md-8 text-right">
                    <input type="submit" name="submitButton" class="btn btn-search" value="continuar" id="btnContinue">
                </div>
            </div>
        </article>
    </form>
</section>

#{spinnerModal/}

#{set 'scriptFiles'}
#{get 'scriptFiles' /}
<script type="text/javascript" src="@{PaymentFlowController.javascript}"></script>




<script type="text/javascript">
	function numberWithCommas(x) {
		return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
	}

	$(function () {
		var selectedCurrency = "${selectedCurrency}";
		$( ".clppriceCon" ).each(function( index ) {
				$(this).html(numberWithCommas($(this).html()));
			});	
// 		if (selectedCurrency=="clp"){
// 			$( ".usdpriceCon" ).each(function( index ) {
// 				var exchangeRate = parseFloat("${dollarExchangeRate}");
// 				var numToChange = parseFloat($(this).html());
// 				$(this).html(numberWithCommas(parseFloat(numToChange * exchangeRate).toFixed(0)));
// 			});	
// 			$( ".simbolCurrency" ).each(function( index ) {
// 				$(this).html("$");
// 			});	
// 			$( ".clppriceCon" ).each(function( index ) {
// 				$(this).html(numberWithCommas($(this).html()));
// 			});	
// 		}
	});

</script>


#{/set}

#{modalNeadHelp /}
#{modalExpiredSession /}

#{set isAgencyFooter: true /}

